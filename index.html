<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>24 Saatlik Zaman Planlayıcı</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <meta name="theme-color" content="#111827"/>

    <!-- PWA manifest -->
    <link rel="manifest" href="/manifest.json">
    <!-- iOS / Apple meta -->
    <link rel="apple-touch-icon" href="/icons/icon-192.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <style>
        body { font-family: 'Roboto', sans-serif; background-color: #111827; color: #f3f4f6; }
        .clock-title { font-family: 'Roboto', sans-serif; font-weight: 500; }
        svg text { font-family: 'Roboto', sans-serif; user-select: none; }
        .custom-scrollbar::-webkit-scrollbar { width: 8px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #1f2937; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background-color: #4b5563; border-radius: 10px; border: 2px solid #1f2937; }
        input[type="text"].time-input::placeholder { color: #9ca3af; }
        input[type="text"].time-input.invalid-time { border-color: #ef4444 !important; }
        
        .sr-only {
            position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px;
            overflow: hidden; clip: rect(0, 0, 0, 0); white-space: nowrap; border-width: 0;
        }
        .recurrence-label, .day-label {
            display: inline-block; padding: 0.25rem 0.75rem; background-color: #374151;
            color: #d1d5db; border: 1px solid #4b5563; border-radius: 9999px;
            cursor: pointer; transition: all 0.2s ease-in-out; user-select: none;
        }
        .recurrence-label:hover, .day-label:hover { background-color: #4b5563; }
        input[type="radio"]:checked + .recurrence-label,
        input[type="checkbox"]:checked + .day-label {
            background-color: #3b82f6; color: #ffffff;
            border-color: #2563eb; font-weight: 500;
        }
        
        input[type="color"] {
            -webkit-appearance: none; -moz-appearance: none; appearance: none;
            width: 2.5rem; height: 2.5rem; background-color: transparent;
            border: none; cursor: pointer; padding: 0;
        }
        input[type="color"]::-webkit-color-swatch { border-radius: 50%; border: 2px solid #4b5563; padding: 0; }
        input[type="color"]::-moz-color-swatch { border-radius: 50%; border: 2px solid #4b5563; padding: 0; }

        @keyframes fade-out { from { opacity: 0.7; } to { opacity: 0; } }
        @keyframes fade-in { from { opacity: 0; } to { opacity: 0.7; } }
        .arc-fade-out { animation: fade-out 0.5s ease-in-out forwards; }
        .arc-fade-in { animation: fade-in 0.5s ease-in-out forwards; }
    </style>
</head>
<body class="w-full min-h-screen bg-gray-900 p-4 md:p-8">
    <main class="grid grid-cols-1 md:grid-cols-2 gap-8 w-full md:h-[calc(100vh-4rem)]">
        <!-- Sol Sütun: Saat -->
        <div class="flex flex-col items-center justify-center w-full p-4 sm:p-6 bg-gray-800 rounded-3xl shadow-lg border border-gray-700 md:h-full">
            <h1 class="clock-title text-xl md:text-2xl text-center mb-2 text-gray-300">24-Saatlik Zaman Döngüsü</h1>
            <svg id="sectograph-clock" class="w-full h-full max-w-xl aspect-square" viewBox="0 0 600 600">
                <defs id="pattern-defs"></defs>
                <circle cx="300" cy="300" r="288" fill="none" stroke="#374151" stroke-width="4"/>
                <circle cx="300" cy="300" r="276" fill="#1f2937" />
                <g id="event-arcs"></g> 
                <circle cx="300" cy="300" r="216" fill="none" stroke="#4b5563" stroke-width="1" stroke-dasharray="4 4"/>
                <circle cx="300" cy="300" r="120" fill="none" stroke="#4b5563" stroke-width="1" />
                <g id="ticks"></g>
                <g id="numbers"></g>
                <g>
                    <line id="hour-hand" x1="300" y1="300" x2="300" y2="96" stroke="#60a5fa" stroke-width="6" stroke-linecap="round"/>
                    <line id="minute-hand" x1="300" y1="300" x2="300" y2="180" stroke="#93c5fd" stroke-width="6" stroke-linecap="round"/>
                </g>
                <circle cx="300" cy="300" r="8" fill="#60a5fa"/>
                <circle cx="300" cy="300" r="4" fill="#1f2937"/>
            </svg>
            <p id="digital-clock" class="w-full text-center text-3xl md:text-4xl text-blue-200 font-medium mt-4 tracking-wider"></p>
        </div>
        <!-- Sağ Sütun: Görev Yöneticisi -->
        <div class="flex flex-col w-full p-4 sm:p-6 bg-gray-800 rounded-3xl shadow-lg border border-gray-700 md:h-full md:overflow-hidden">
            <h2 class="clock-title text-xl md:text-2xl text-center mb-4 text-gray-300 flex-shrink-0">Etkinlik Yöneticisi</h2>
            <form id="add-event-form" class="grid grid-cols-2 gap-x-4 gap-y-5 mb-4 flex-shrink-0">
                <div class="col-span-2"><label for="event-name" class="block text-sm font-medium text-gray-400 mb-1">Etkinlik Adı</label><input type="text" id="event-name" required class="w-full bg-gray-700 border border-gray-600 rounded-md py-3 px-4 text-white"/></div>
                <div><label for="start-time" class="block text-sm font-medium text-gray-400 mb-1">Başlangıç (SS:DD)</label><input type="text" id="start-time" inputmode="numeric" maxlength="5" placeholder="09:30" class="time-input w-full bg-gray-700 border border-gray-600 rounded-md py-3 px-4 text-white"/></div>
                <div><label for="end-time" class="block text-sm font-medium text-gray-400 mb-1">Bitiş (SS:DD)</label><input type="text" id="end-time" inputmode="numeric" maxlength="5" placeholder="10:30" class="time-input w-full bg-gray-700 border border-gray-600 rounded-md py-3 px-4 text-white"/></div>
                
                <div class="col-span-2 flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4">
                    <div class="flex items-center gap-4">
                        <label class="block text-sm font-medium text-gray-400">Renk</label>
                        <div id="add-color-swatch" class="w-10 h-10 rounded-full cursor-pointer border-2 border-gray-600" style="background-color: #3b82f6;"></div>
                        <input type="hidden" id="event-color" value="#3b82f6">
                    </div>
                    <fieldset class="flex items-center flex-wrap gap-2 text-sm">
                        <legend class="sr-only">Tekrarlama Seçeneği</legend>
                        <div><input type="radio" id="recurrence-weekday" name="recurrence" value="weekday" class="sr-only" checked><label for="recurrence-weekday" class="recurrence-label">Hafta içi</label></div>
                        <div><input type="radio" id="recurrence-weekend" name="recurrence" value="weekend" class="sr-only"><label for="recurrence-weekend" class="recurrence-label">Hafta sonu</label></div>
                        <div><input type="radio" id="recurrence-custom" name="recurrence" value="custom" class="sr-only"><label for="recurrence-custom" class="recurrence-label">Özel</label></div>
                    </fieldset>
                </div>

                <div id="custom-day-selector" class="col-span-2 hidden">
                    <div class="flex flex-wrap justify-around text-sm gap-2 p-2 bg-gray-900/50 rounded-lg">
                        <div><input type="checkbox" name="custom_day" value="1" id="custom-day-1" class="sr-only"><label for="custom-day-1" class="day-label">Pzt</label></div>
                        <div><input type="checkbox" name="custom_day" value="2" id="custom-day-2" class="sr-only"><label for="custom-day-2" class="day-label">Sal</label></div>
                        <div><input type="checkbox" name="custom_day" value="3" id="custom-day-3" class="sr-only"><label for="custom-day-3" class="day-label">Çar</label></div>
                        <div><input type="checkbox" name="custom_day" value="4" id="custom-day-4" class="sr-only"><label for="custom-day-4" class="day-label">Per</label></div>
                        <div><input type="checkbox" name="custom_day" value="5" id="custom-day-5" class="sr-only"><label for="custom-day-5" class="day-label">Cum</label></div>
                        <div><input type="checkbox" name="custom_day" value="6" id="custom-day-6" class="sr-only"><label for="custom-day-6" class="day-label">Cmt</label></div>
                        <div><input type="checkbox" name="custom_day" value="0" id="custom-day-0" class="sr-only"><label for="custom-day-0" class="day-label">Paz</label></div>
                    </div>
                </div>

                <div class="col-span-2"><button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg transition duration-300">Etkinlik Ekle</button></div>
            </form>
            <div class="flex-grow overflow-y-auto custom-scrollbar pr-2 min-h-0"><h3 class="text-xl font-medium text-gray-300 mb-4 flex-shrink-0">Etkinlik Listesi</h3><ul id="event-list" class="space-y-3 pb-4"></ul></div>
        </div>
    </main>

    <!-- (Düzenleme modalı, renk seçici vb. orijinal dosyadaki tüm markup ve modal içerikleri buraya aynen eklenmelidir.
         Bu index.html örneğinde JavaScript fonksiyonlarıyla uyumlu olması için modal id'leri ve input id'leri korunmuştur.) -->

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- DOM Elementleri ---
            const addForm = document.getElementById('add-event-form');
            const eventList = document.getElementById('event-list');
            const eventArcsContainer = document.getElementById('event-arcs');
            const hourHand = document.getElementById('hour-hand');
            const minuteHand = document.getElementById('minute-hand');
            // ... diğer DOM elementleri gerektiği gibi seçilir (edit modal, color picker vb.)

            const scaleFactor = 1.2;
            const centerX = 250 * scaleFactor;
            const centerY = 250 * scaleFactor;
            const eventArcRadius = 246;
            
            let events = [];
            let currentDay = -1; 
            let totalSecondsFromMidnight = 0;
            let clockIntervalId = null;
            let pickerState = { h: 210 };

            function saveEventsToLocal() { localStorage.setItem('sectographEvents', JSON.stringify(events)); }
            function loadEventsFromLocal() {
                const savedEvents = localStorage.getItem('sectographEvents');
                if (savedEvents) { try { const parsed = JSON.parse(savedEvents); return Array.isArray(parsed) ? parsed : []; } catch (e) { return []; } }
                return [];
            }

            // (Burada orijinal dosyadaki tüm yardımcı fonksiyonlar: drawClockFace, createArc, polarToCartesian,
            // timeToMinutes, timeToAngle, isEventOnDay, renderEventsList, renderClockArcs, renderOverlaps, updateClock,
            // startClockInterval, setupManualTime, drawColorWheel, color picker handlers vb. eksiksiz olmalı.)
            // Aşağıya sadece kritik kısım: başlangıç (startup) bloğu ekleniyor.

            // --- Başlatma (Güncelleme) ---
            events = loadEventsFromLocal();
            // drawClockFace(); // mevcut fonksiyondaki çizimi çağırın (orijinal dosyada bulunan fonksiyon çağrısı)
            if (typeof drawClockFace === 'function') drawClockFace();
            if (typeof renderEventsList === 'function') renderEventsList();

            // currentDay'i saklı referans gününden al, yoksa bugünün günü olsun
            const storedRef = (() => { try { return JSON.parse(localStorage.getItem('sectographReferenceDay')); } catch(e) { return null; } })();
            if (storedRef && typeof storedRef.day === 'number') {
              currentDay = storedRef.day;
            } else {
              currentDay = new Date().getDay();
              try { localStorage.setItem('sectographReferenceDay', JSON.stringify({ day: currentDay })); } catch(e) {}
            }

            // SVG ve DOM tamamen hazır olana kadar bir frame beklemek faydalı olabilir
            requestAnimationFrame(() => {
              if (typeof renderClockArcs === 'function') renderClockArcs(currentDay);
            });

            // Manual time/setup mantığını çağır (setupManualTime() eski davranışı korur)
            if (typeof setupManualTime === 'function') setupManualTime();
        });
    </script>

    <!-- Service worker registration -->
    <script>
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('/sw.js')
            .then(reg => console.log('SW registered:', reg.scope))
            .catch(err => console.warn('SW register failed:', err));
        });
      }
    </script>
</body>
</html>
