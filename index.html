<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>24 Saatlik Zaman Planlayıcı</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <!-- PWA için Manifest Dosyası -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#111827"/>
    <style>
        body { font-family: 'Roboto', sans-serif; background-color: #111827; color: #f3f4f6; }
        .clock-title { font-family: 'Roboto', sans-serif; font-weight: 500; }
        svg text { font-family: 'Roboto', sans-serif; user-select: none; }
        .custom-scrollbar::-webkit-scrollbar { width: 8px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #1f2937; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background-color: #4b5563; border-radius: 10px; border: 2px solid #1f2937; }
        input[type="text"].time-input::placeholder { color: #9ca3af; }
        input[type="text"].time-input.invalid-time { border-color: #ef4444 !important; }
    </style>
</head>
<body class="w-full h-screen bg-gray-900 overflow-hidden p-4 md:p-8">
    <main class="grid grid-cols-1 md:grid-cols-2 gap-8 w-full h-full">
        <!-- Sol Sütun: Saat (Dikeyde üste gelir) -->
        <div class="flex flex-col items-center justify-center w-full p-4 sm:p-6 bg-gray-800 rounded-3xl shadow-lg border border-gray-700 md:h-full">
            <h1 class="clock-title text-2xl md:text-3xl text-center mb-4 text-gray-300">24-Saatlik Zaman Döngüsü</h1>
            <svg id="sectograph-clock" class="w-full h-full max-w-xl aspect-square" viewBox="0 0 500 500">
                <defs id="pattern-defs"></defs>
                <circle cx="250" cy="250" r="240" fill="none" stroke="#374151" stroke-width="4"/>
                <circle cx="250" cy="250" r="230" fill="#1f2937" />
                <circle cx="250" cy="250" r="180" fill="none" stroke="#4b5563" stroke-width="1" stroke-dasharray="4 4"/>
                <circle cx="250" cy="250" r="100" fill="none" stroke="#4b5563" stroke-width="1" />
                <g id="event-arcs"></g>
                <g id="ticks"></g>
                <g id="numbers"></g>
                <g>
                    <line id="hour-hand" x1="250" y1="250" x2="250" y2="150" stroke="#60a5fa" stroke-width="6" stroke-linecap="round"/>
                    <line id="minute-hand" x1="250" y1="250" x2="250" y2="80" stroke="#93c5fd" stroke-width="6" stroke-linecap="round"/>
                </g>
                <circle cx="250" cy="250" r="8" fill="#60a5fa"/>
                <circle cx="250" cy="250" r="4" fill="#1f2937"/>
            </svg>
        </div>
        <!-- Sağ Sütun: Görev Yöneticisi (Dikeyde alta gelir) -->
        <div class="flex flex-col w-full h-full p-4 sm:p-6 bg-gray-800 rounded-3xl shadow-lg border border-gray-700 overflow-hidden">
            <h2 class="clock-title text-2xl md:text-3xl text-center mb-6 text-gray-300 flex-shrink-0">Etkinlik Yöneticisi</h2>
            <form id="add-event-form" class="grid grid-cols-2 gap-4 mb-6 flex-shrink-0">
                <div class="col-span-2"><label for="event-name" class="block text-sm font-medium text-gray-400 mb-1">Etkinlik Adı</label><input type="text" id="event-name" required class="w-full bg-gray-700 border border-gray-600 rounded-md py-2 px-3 text-white focus:ring-2 focus:ring-blue-500 focus:outline-none"></div>
                <div><label for="start-time" class="block text-sm font-medium text-gray-400 mb-1">Başlangıç (SS:DD)</label><input type="text" id="start-time" inputmode="numeric" maxlength="5" placeholder="09:30" required class="time-input w-full bg-gray-700 border border-gray-600 rounded-md py-2 px-3 text-white focus:ring-2 focus:ring-blue-500 focus:outline-none"></div>
                <div><label for="end-time" class="block text-sm font-medium text-gray-400 mb-1">Bitiş (SS:DD)</label><input type="text" id="end-time" inputmode="numeric" maxlength="5" placeholder="10:30" required class="time-input w-full bg-gray-700 border border-gray-600 rounded-md py-2 px-3 text-white focus:ring-2 focus:ring-blue-500 focus:outline-none"></div>
                <div class="col-span-2 flex items-center gap-4"><label for="event-color" class="block text-sm font-medium text-gray-400">Renk</label><input type="color" id="event-color" value="#3b82f6" class="bg-gray-700 rounded-md"></div>
                <div class="col-span-2"><button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg transition duration-300">Etkinlik Ekle</button></div>
            </form>
            <div class="flex-grow overflow-y-auto custom-scrollbar pr-2 min-h-0"><h3 class="text-xl font-medium text-gray-300 mb-4 flex-shrink-0">Etkinlik Listesi</h3><ul id="event-list" class="space-y-3"></ul></div>
        </div>
    </main>
    <!-- Düzenleme Modalı -->
    <div id="edit-modal-backdrop" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center hidden z-50">
        <div class="bg-gray-800 rounded-2xl shadow-xl p-8 w-full max-w-md border border-gray-700">
            <h2 class="text-2xl font-bold text-white mb-6">Etkinliği Düzenle</h2>
            <form id="edit-event-form">
                <input type="hidden" id="edit-event-id">
                <div class="mb-4"><label for="edit-event-name" class="block text-sm font-medium text-gray-400 mb-1">Etkinlik Adı</label><input type="text" id="edit-event-name" required class="w-full bg-gray-700 border border-gray-600 rounded-md py-2 px-3 text-white focus:ring-2 focus:ring-blue-500 focus:outline-none"></div>
                <div class="grid grid-cols-2 gap-4 mb-4">
                    <div><label for="edit-start-time" class="block text-sm font-medium text-gray-400 mb-1">Başlangıç (SS:DD)</label><input type="text" id="edit-start-time" inputmode="numeric" maxlength="5" required class="time-input w-full bg-gray-700 border border-gray-600 rounded-md py-2 px-3 text-white focus:ring-2 focus:ring-blue-500 focus:outline-none"></div>
                    <div><label for="edit-end-time" class="block text-sm font-medium text-gray-400 mb-1">Bitiş (SS:DD)</label><input type="text" id="edit-end-time" inputmode="numeric" maxlength="5" required class="time-input w-full bg-gray-700 border border-gray-600 rounded-md py-2 px-3 text-white focus:ring-2 focus:ring-blue-500 focus:outline-none"></div>
                </div>
                <div class="mb-6"><label for="edit-event-color" class="block text-sm font-medium text-gray-400 mb-2">Renk</label><input type="color" id="edit-event-color" class="bg-gray-700 rounded-md"></div>
                <div class="flex justify-end gap-4"><button type="button" id="cancel-edit-btn" class="bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded-lg transition duration-300">İptal</button><button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg transition duration-300">Kaydet</button></div>
            </form>
        </div>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- DOM Elementleri ---
            const addForm = document.getElementById('add-event-form');
            const eventList = document.getElementById('event-list');
            const eventArcsContainer = document.getElementById('event-arcs');
            const hourHand = document.getElementById('hour-hand');
            const minuteHand = document.getElementById('minute-hand');
            const editModalBackdrop = document.getElementById('edit-modal-backdrop');
            const editForm = document.getElementById('edit-event-form');
            const cancelEditBtn = document.getElementById('cancel-edit-btn');
            
            const centerX = 250, centerY = 250, eventArcRadius = 205;
            let events = [];

            // --- Veri Saklama Fonksiyonları (LocalStorage) ---
            function saveEventsToLocal() {
                localStorage.setItem('sectographEvents', JSON.stringify(events));
            }

            function loadEventsFromLocal() {
                const savedEvents = localStorage.getItem('sectographEvents');
                if (savedEvents) {
                    try {
                        const parsed = JSON.parse(savedEvents);
                        return Array.isArray(parsed) ? parsed : [];
                    } catch (e) { return []; }
                }
                return [{ id: Date.now(), name: 'Örnek Toplantı', start: '09:00', end: '10:30', color: '#3b82f6' }];
            }

            // --- Saat Arayüzü Çizim Fonksiyonları ---
            function drawClockFace() {
                const ticks = document.getElementById('ticks');
                const numbers = document.getElementById('numbers');
                ticks.innerHTML = '';
                numbers.innerHTML = '';
                const radius = 195;
                const tickOuterRadius = 230;

                for (let i = 0; i < (24 * 6); i++) {
                    const totalMinutes = i * 10;
                    const h = Math.floor(totalMinutes / 60);
                    const m = totalMinutes % 60;
                    const angle = (totalMinutes / (24 * 60)) * 360 - 90;
                    const angleRad = angle * (Math.PI / 180);
                    const isHourTick = m === 0;
                    const isMajorHourTick = isHourTick && (h % 6 === 0);
                    let tickStartRadius, tickWidth, tickColor;
                    if (isHourTick) {
                        tickStartRadius = isMajorHourTick ? 215 : 220;
                        tickWidth = isMajorHourTick ? '3' : '2';
                        tickColor = isMajorHourTick ? '#60a5fa' : '#4b5563';
                    } else {
                        tickStartRadius = 225;
                        tickWidth = '1';
                        tickColor = '#4b5563';
                    }
                    const x1 = centerX + tickStartRadius * Math.cos(angleRad);
                    const y1 = centerY + tickStartRadius * Math.sin(angleRad);
                    const x2 = centerX + tickOuterRadius * Math.cos(angleRad);
                    const y2 = centerY + tickOuterRadius * Math.sin(angleRad);
                    const tick = document.createElementNS("http://www.w3.org/2000/svg", "line");
                    tick.setAttribute('x1', x1); tick.setAttribute('y1', y1);
                    tick.setAttribute('x2', x2); tick.setAttribute('y2', y2);
                    tick.setAttribute('stroke', tickColor); tick.setAttribute('stroke-width', tickWidth);
                    ticks.appendChild(tick);
                }

                for (let h = 0; h < 24; h++) {
                    const angle = (h / 24) * 360 - 90;
                    const angleRad = angle * (Math.PI / 180);
                    const isMajorTick = h % 6 === 0;
                    const numX = centerX + radius * Math.cos(angleRad);
                    const numY = centerY + radius * Math.sin(angleRad);
                    const numberText = document.createElementNS("http://www.w3.org/2000/svg", "text");
                    numberText.setAttribute('x', numX); numberText.setAttribute('y', numY);
                    numberText.setAttribute('fill', isMajorTick ? '#93c5fd' : '#9ca3af');
                    numberText.setAttribute('font-weight', isMajorTick ? '500' : '400');
                    numberText.setAttribute('text-anchor', 'middle');
                    numberText.setAttribute('dominant-baseline', 'central');
                    if (h === 0) {
                        numberText.setAttribute('font-size', '20');
                        numberText.textContent = '24:00';
                    } else {
                        numberText.setAttribute('font-size', isMajorTick ? '22' : '16');
                        numberText.textContent = h.toString().padStart(2, '0');
                    }
                    numbers.appendChild(numberText);
                }
            }
            
            // --- Zaman Girdi Formatlama ve Doğrulama ---
            function handleTimeInput(event) {
                const input = event.target;
                const type = event.type;
                
                if (type === 'input') {
                    let value = input.value;
                    let digits = value.replace(/\D/g, '');

                    if (digits.length > 2) {
                        input.value = `${digits.substring(0, 2)}:${digits.substring(2, 4)}`;
                    } else {
                        input.value = digits;
                    }
                } 
                else if (type === 'blur') {
                    const timeRegex = /^([01]\d|2[0-3]):([0-5]\d)$/;
                    if (input.value.length > 0 && !timeRegex.test(input.value)) {
                        input.classList.add('invalid-time');
                    } else {
                        input.classList.remove('invalid-time');
                    }
                }
            }

            // --- Etkinlik (Event) Yönetim Fonksiyonları ---
            function renderEvents() {
                eventList.innerHTML = '';
                eventArcsContainer.innerHTML = '';
                const patternDefs = document.getElementById('pattern-defs');
                if (patternDefs) patternDefs.innerHTML = '';

                if (events.length === 0) {
                    eventList.innerHTML = `<p class="text-gray-500 text-center">Henüz etkinlik eklenmedi.</p>`;
                    return;
                }

                const sortedEvents = [...events].sort((a, b) => timeToMinutes(a.start) - timeToMinutes(b.start));
                
                sortedEvents.forEach(event => {
                    const li = document.createElement('li');
                    li.className = 'bg-gray-700 p-3 rounded-lg flex items-center justify-between';
                    li.innerHTML = `
                        <div class="flex items-center overflow-hidden mr-2">
                            <span class="w-4 h-4 rounded-full mr-3 flex-shrink-0" style="background-color: ${event.color};"></span>
                            <div class="truncate">
                                <p class="font-semibold text-white truncate">${event.name}</p>
                                <p class="text-sm text-gray-400">${event.start} - ${event.end}</p>
                            </div>
                        </div>
                        <div class="flex items-center flex-shrink-0">
                            <button data-id="${event.id}" class="edit-btn text-gray-400 hover:text-white p-2">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor" style="pointer-events: none;"><path d="M10 6a2 2 0 110-4 2 2 0 010 4zM10 12a2 2 0 110-4 2 2 0 010 4zM10 18a2 2 0 110-4 2 2 0 010 4z" /></svg>
                            </button>
                            <button data-id="${event.id}" class="delete-btn text-gray-500 hover:text-red-400 text-2xl leading-none px-2">&times;</button>
                        </div>`;
                    eventList.appendChild(li);

                    const startAngle = timeToAngle(event.start);
                    const endAngle = timeToAngle(event.end);
                    if (timeToMinutes(event.end) < timeToMinutes(event.start)) {
                        const arc1 = createArc(centerX, centerY, eventArcRadius, startAngle, 270);
                        const path1 = document.createElementNS("http://www.w3.org/2000/svg", "path");
                        path1.setAttribute('d', arc1); path1.setAttribute('fill', event.color); path1.setAttribute('fill-opacity', '0.6');
                        eventArcsContainer.appendChild(path1);
                        const arc2 = createArc(centerX, centerY, eventArcRadius, -90, endAngle);
                        const path2 = document.createElementNS("http://www.w3.org/2000/svg", "path");
                        path2.setAttribute('d', arc2); path2.setAttribute('fill', event.color); path2.setAttribute('fill-opacity', '0.6');
                        eventArcsContainer.appendChild(path2);
                    } else {
                        const arc = createArc(centerX, centerY, eventArcRadius, startAngle, endAngle);
                        const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
                        path.setAttribute('d', arc); path.setAttribute('fill', event.color); path.setAttribute('fill-opacity', '0.6');
                        eventArcsContainer.appendChild(path);
                    }
                });

                renderOverlaps(sortedEvents);
            }

            function renderOverlaps(sortedEvents) {
                const drawnPatterns = {};
                for (let i = 0; i < sortedEvents.length; i++) {
                    for (let j = i + 1; j < sortedEvents.length; j++) {
                        const event1 = sortedEvents[i];
                        const event2 = sortedEvents[j];
                        const getIntervals = (e) => {
                            const start = timeToMinutes(e.start);
                            const end = timeToMinutes(e.end);
                            return (end < start) ? [[start, 1440], [0, end]] : [[start, end]];
                        };
                        const intervals1 = getIntervals(event1);
                        const intervals2 = getIntervals(event2);
                        for (const int1 of intervals1) {
                            for (const int2 of intervals2) {
                                const overlapStart = Math.max(int1[0], int2[0]);
                                const overlapEnd = Math.min(int1[1], int2[1]);
                                if (overlapStart < overlapEnd) {
                                    const overlapColor = event2.color;
                                    const patternId = `pattern-${overlapColor.replace('#', '')}`;
                                    if (!drawnPatterns[patternId]) {
                                        const pattern = document.createElementNS("http://www.w3.org/2000/svg", "pattern");
                                        pattern.setAttribute('id', patternId);
                                        pattern.setAttribute('patternUnits', 'userSpaceOnUse');
                                        pattern.setAttribute('width', '8'); pattern.setAttribute('height', '8');
                                        pattern.setAttribute('patternTransform', 'rotate(45)');
                                        const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
                                        line.setAttribute('x1', '0'); line.setAttribute('y1', '0'); line.setAttribute('x2', '0'); line.setAttribute('y2', '8');
                                        line.setAttribute('stroke', overlapColor); line.setAttribute('stroke-width', '4');
                                        pattern.appendChild(line);
                                        document.getElementById('pattern-defs').appendChild(pattern);
                                        drawnPatterns[patternId] = true;
                                    }
                                    const overlapStartAngle = (overlapStart / 1440) * 360 - 90;
                                    const overlapEndAngle = (overlapEnd / 1440) * 360 - 90;
                                    const arc = createArc(centerX, centerY, eventArcRadius, overlapStartAngle, overlapEndAngle);
                                    const overlapPath = document.createElementNS("http://www.w3.org/2000/svg", "path");
                                    overlapPath.setAttribute('d', arc);
                                    overlapPath.setAttribute('fill', `url(#${patternId})`);
                                    eventArcsContainer.appendChild(overlapPath);
                                }
                            }
                        }
                    }
                }
            }
            
            function openEditModal(eventId) {
                const eventToEdit = events.find(e => e.id === eventId);
                if (eventToEdit) {
                    document.getElementById('edit-event-id').value = eventToEdit.id;
                    document.getElementById('edit-event-name').value = eventToEdit.name;
                    document.getElementById('edit-start-time').value = eventToEdit.start;
                    document.getElementById('edit-end-time').value = eventToEdit.end;
                    document.getElementById('edit-event-color').value = eventToEdit.color;
                    editModalBackdrop.classList.remove('hidden');
                }
            }
            function closeEditModal() { editModalBackdrop.classList.add('hidden'); }

            // --- Olay Dinleyicileri (Event Listeners) ---
            addForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const startTimeInput = document.getElementById('start-time');
                const endTimeInput = document.getElementById('end-time');
                const timeRegex = /^([01]\d|2[0-3]):([0-5]\d)$/;

                // Son kontrol
                handleTimeInput({ target: startTimeInput, type: 'blur' });
                handleTimeInput({ target: endTimeInput, type: 'blur' });

                if (timeRegex.test(startTimeInput.value) && timeRegex.test(endTimeInput.value)) {
                    const newEvent = {
                        id: Date.now(),
                        name: document.getElementById('event-name').value,
                        start: startTimeInput.value,
                        end: endTimeInput.value,
                        color: document.getElementById('event-color').value,
                    };
                    events.push(newEvent);
                    saveEventsToLocal();
                    renderEvents();
                    addForm.reset();
                    document.getElementById('event-color').value = '#3b82f6';
                } else {
                    alert('Lütfen başlangıç ve bitiş saatlerini doğru formatta (SS:DD) giriniz.');
                }
            });

            editForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const eventId = parseInt(document.getElementById('edit-event-id').value);
                const eventIndex = events.findIndex(event => event.id === eventId);
                const startTimeInput = document.getElementById('edit-start-time');
                const endTimeInput = document.getElementById('edit-end-time');
                const timeRegex = /^([01]\d|2[0-3]):([0-5]\d)$/;
                
                handleTimeInput({ target: startTimeInput, type: 'blur' });
                handleTimeInput({ target: endTimeInput, type: 'blur' });

                if (eventIndex > -1 && timeRegex.test(startTimeInput.value) && timeRegex.test(endTimeInput.value)) {
                    events[eventIndex] = {
                        id: eventId,
                        name: document.getElementById('edit-event-name').value,
                        start: startTimeInput.value,
                        end: endTimeInput.value,
                        color: document.getElementById('edit-event-color').value,
                    };
                    saveEventsToLocal();
                    renderEvents();
                    closeEditModal();
                } else {
                     alert('Lütfen başlangıç ve bitiş saatlerini doğru formatta (SS:DD) giriniz.');
                }
            });

            eventList.addEventListener('click', (e) => {
                const button = e.target.closest('button');
                if (!button) return;
                const eventId = parseInt(button.dataset.id);
                if (button.classList.contains('delete-btn')) {
                    events = events.filter(event => event.id !== eventId);
                    saveEventsToLocal();
                    renderEvents();
                } else if (button.classList.contains('edit-btn')) {
                    openEditModal(eventId);
                }
            });

            cancelEditBtn.addEventListener('click', closeEditModal);
            editModalBackdrop.addEventListener('click', e => { if(e.target === editModalBackdrop) closeEditModal(); });
            
            ['start-time', 'end-time', 'edit-start-time', 'edit-end-time'].forEach(id => {
                const input = document.getElementById(id);
                input.addEventListener('input', handleTimeInput);
                input.addEventListener('blur', handleTimeInput);
            });

            // --- Yardımcı Fonksiyonlar ---
            function timeToMinutes(timeStr) {
                if (!timeStr || !timeStr.includes(':')) return 0;
                const [hours, minutes] = timeStr.split(':').map(Number);
                return hours * 60 + minutes;
            }
            function timeToAngle(timeStr) {
                return (timeToMinutes(timeStr) / 1440) * 360 - 90;
            }
            function polarToCartesian(cx, cy, radius, angleInDegrees) {
                const angleInRadians = angleInDegrees * Math.PI / 180.0;
                return { x: cx + (radius * Math.cos(angleInRadians)), y: cy + (radius * Math.sin(angleInRadians)) };
            }
            function createArc(cx, cy, radius, startAngle, endAngle) {
                if (endAngle < startAngle) endAngle += 360;
                const start = polarToCartesian(cx, cy, radius, endAngle);
                const end = polarToCartesian(cx, cy, radius, startAngle);
                const largeArcFlag = endAngle - startAngle <= 180 ? "0" : "1";
                return ["M", start.x, start.y, "A", radius, radius, 0, largeArcFlag, 0, end.x, end.y, "L", cx, cy, "Z"].join(" ");
            }

            // --- Saat Güncelleme ---
            function updateClock() {
                const now = new Date();
                const h = now.getHours();
                const m = now.getMinutes();
                const s = now.getSeconds();
                const hourAngle = (h * 60 + m) / (24 * 60) * 360 - 90;
                const minuteAngle = (m * 60 + s) / 3600 * 360 - 90;
                hourHand.setAttribute('transform', `rotate(${hourAngle}, 250, 250)`);
                minuteHand.setAttribute('transform', `rotate(${minuteAngle}, 250, 250)`);
            }

            // --- Başlatma ---
            events = loadEventsFromLocal();
            drawClockFace();
            renderEvents();
            updateClock();
            setInterval(updateClock, 1000);
        });
    </script>
</body>
</html>

